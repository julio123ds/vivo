<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Convertidor Excel ↔ CSV (Offline)</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

    :root {
      --bg-light: linear-gradient(to right, #fff3e0, #e8f5e9);
      --panel-light: #ffffff;
      --text-light: #2b2b2b;
      --accent1-light: #d84315;
      --accent2-light: #2e7d32;
      --border-light: #ddd;
      --highlight-light: #ffcc00;

      --bg-dark: radial-gradient(circle at 30% 30%, #0b1824, #0d1117);
      --panel-dark: #161b22;
      --text-dark: #e6edf3;
      --accent1-dark: #ff9f43;
      --accent2-dark: #5cd6a4;
      --border-dark: #2c3138;
      --highlight-dark: #00bcd4;
    }

    body {
      font-family: "Inter", "Segoe UI", system-ui, sans-serif;
      background: var(--bg-light);
      color: var(--text-light);
      margin: 0;
      padding: 0rem;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      transition: background 0.6s ease, color 0.6s ease;
      font-size: 17px;
      overflow-x: hidden;
    }

    body.dark { background: var(--bg-dark); color: var(--text-dark); }

    .container {
      display: flex;
      gap: 2rem;
      flex-wrap: wrap;
      justify-content: center;
      width: 100%;
      max-width: 1300px;
      align-items: flex-start;
      animation: fadeIn 0.8s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      text-align: center;
      width: 100%;
      font-size: 2.5rem;
      margin-top: 0.3rem;
      margin-bottom: 1.5rem;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(0,0,0,0.15);
    }

    body.dark h1 { color: var(--accent2-dark); }

    .panel {
      background: var(--panel-light);
      border-radius: 18px;
      padding: 2rem 2.5rem;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      flex: 1 1 550px;
      min-width: 520px;
      border: 1px solid var(--border-light);
      transition: transform 0.4s ease, background 0.4s ease, border 0.4s ease;
    }

    .panel:hover { transform: translateY(-5px); }
    body.dark .panel {
      background: var(--panel-dark);
      border-color: var(--border-dark);
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
    }

    h2 { margin-top: 0; font-size: 1.6rem; margin-bottom: 1.5rem; color: var(--accent1-light); }
    h2.csv { color: var(--accent2-light); }
    body.dark h2 { color: var(--accent1-dark); }
    body.dark h2.csv { color: var(--accent2-dark); }

    .file-input-wrapper {
      border: 2px dashed var(--accent1-light);
      padding: 2rem;
      border-radius: 14px;
      background-color: #fff8f2;
      cursor: pointer;
      transition: 0.3s;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 110px;
      animation: heartbeat 2.5s infinite;
      position: relative;
      user-select: none;
    }

    @keyframes heartbeat {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.02); opacity: 0.9; }
    }

    .file-input-wrapper.csv {
      border-color: var(--accent2-light);
      background-color: #f4fff6;
    }

    body.dark .file-input-wrapper {
      border-color: var(--accent1-dark);
      background-color: #1c2128;
    }

    body.dark .file-input-wrapper.csv {
      border-color: var(--accent2-dark);
      background-color: #142620;
    }

    .file-input-wrapper.loaded { animation: none; opacity: 1; }
    .file-input-wrapper input[type="file"] { display: none; }
    .file-label { font-weight: 600; text-align: center; font-size: 1rem; padding: 0 12px; }

    button {
      background-color: var(--accent1-light);
      color: white;
      border: none;
      padding: 1rem 1.5rem;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s;
      width: 100%;
      font-size: 1.05rem;
      font-weight: 500;
    }

    button.csv { background-color: var(--accent2-light); }
    body.dark button { background-color: var(--accent1-dark); }
    body.dark button.csv { background-color: var(--accent2-dark); }
    button:hover { transform: scale(1.03); opacity: 0.95; }

    #warning.active { color: var(--accent1-light); font-weight: bold; margin-bottom: 0.8rem; }

    #duplicates span {
      background: var(--highlight-light);
      padding: 6px 10px;
      border-radius: 6px;
      margin: 4px;
      display: inline-block;
      font-weight: 600;
      opacity: 0;
      animation: fadeInHighlight 0.5s ease forwards;
    }
    body.dark #duplicates span { background: var(--highlight-dark); color: #fff; }

    @keyframes fadeInHighlight {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .preview-container {
      max-height: 280px;
      overflow: auto;
      border: 1px solid var(--border-light);
      border-radius: 6px;
      margin-bottom: 1rem;
    }

    th, td {
      border: 1px solid var(--border-light);
      padding: 6px;
      text-align: left;
      transition: background 0.3s ease;
    }

    th { background: #fff8f2; position: sticky; top: 0; z-index: 2; }
    .row-number { font-weight: bold; background: #fff8f2; position: sticky; left: 0; }

    body.dark th, body.dark td { border-color: var(--border-dark); }
    body.dark th, body.dark .row-number { background: #1b2026; }

    .duplicate {
      background-color: var(--highlight-light);
      animation: fadeInHighlight 0.5s ease;
    }
    body.dark .duplicate { background-color: var(--highlight-dark); color: #fff; }

    /* Switch sol/luna */
    #darkToggle {
      position: fixed;
      top: 15px;
      right: 20px;
      background: none;
      border: none;
      cursor: pointer;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      transition: 0.4s ease;
      font-size: 28px;
      z-index: 999;
    }

    .sun, .moon {
      position: absolute;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      transition: all 0.6s ease;
      top: 5px;
      right: 5px;
      box-shadow: 0 0 15px rgba(255,255,255,0.5);
    }

    .sun {
      background: radial-gradient(circle, #fff176, #fbc02d);
      animation: spin 8s linear infinite, glow 12s ease-in-out infinite alternate;
    }

    .moon {
      background: radial-gradient(circle, #d1d8e0, #95a5a6);
      box-shadow: 0 0 10px #f5f5f5;
      animation: spin 10s linear infinite, pulse 13s ease-in-out infinite alternate;
    }

    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes glow { from { box-shadow: 0 0 5px #fff9c4; } to { box-shadow: 0 0 15px #fff176; } }
    @keyframes pulse { from { box-shadow: 0 0 6px #ccc; } to { box-shadow: 0 0 15px #ddd; } }

    /* Spinner / checkmark (igual al original) */
    .spinner {
      border: 4px solid #ccc;
      border-top: 4px solid var(--accent1-light);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin2 1s linear infinite;
      position: absolute;
      top: calc(50% - 20px);
      left: calc(50% - 20px);
      display: none;
    }
    @keyframes spin2 { to { transform: rotate(360deg); } }

    .checkmark {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: none;
      position: absolute;
      top: calc(50% - 25px);
      left: calc(50% - 25px);
    }
    .checkmark::after {
      content: "✔";
      position: absolute;
      top: 40px;
      left: 14px;
      font-size: 28px;
      color: var(--accent2-light);
    }
    .show-check { display: block; animation: fadeIn 0.6s ease; }

    /* ===== NUEVOS (inputs y remote result grande) ===== */
    .control {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 12px;
    }
    .control label {
      font-weight: 600;
      font-size: 0.95rem;
      opacity: 0.9;
    }
    .control input, .control select, .control textarea {
      width: 100%;
      border-radius: 10px;
      padding: 12px 12px;
      border: 1px solid var(--border-light);
      outline: none;
      font-size: 1rem;
      transition: 0.25s;
      background: #fff;
      color: var(--text-light);
      box-sizing: border-box;
    }
    body.dark .control input,
    body.dark .control select,
    body.dark .control textarea {
      background: #0f141b;
      color: var(--text-dark);
      border-color: var(--border-dark);
    }

    .remote-big {
      max-height: none;
      min-height: 100px;
      padding: 14px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 1.05rem;
      line-height: 1.6;
      white-space: pre-line;
    }
  </style>
</head>

<body>
  <button id="darkToggle"><div class="sun"></div></button>

  <div class="container">
    <h1>Convertidor entre Excel y CSV</h1>

    <!-- (1) Excel → CSV (ORIGINAL + BOM + spinner/check + duplicados) -->
    <div class="panel">
      <h2>Excel → CSV</h2>
      <label class="file-input-wrapper" id="dropXLSX">
        <input type="file" id="fileInputXLSX" accept=".xlsx, .xls">
        <div class="file-label" id="fileLabelXLSX">Haz clic aquí para subir tu archivo Excel</div>
        <div class="spinner" id="spinner"></div>
        <div class="checkmark" id="checkmark"></div>
      </label>

      <div id="warning"></div>
      <div id="duplicates"></div>
      <div class="preview-container" id="previewContainer"></div>
      <button onclick="convertToCSV()">Descargar CSV</button>
    </div>

    <!-- (2) CSV → Excel (ORIGINAL con TextDecoder fallback) -->
    <div class="panel">
      <h2 class="csv">CSV → Excel</h2>
      <label class="file-input-wrapper csv">
        <input type="file" id="fileInputCSV" accept=".csv" multiple>
        <div class="file-label csv" id="fileLabelCSV">Haz clic aquí para subir hasta 2 archivos CSV</div>
      </label>
      <button class="csv" onclick="convertMultipleCSVs()">Descargar Excel (.xlsx)</button>
    </div>

    <!-- (3) Remote ID (mejorado) -->
    <div class="panel">
      <h2 class="csv">Generador de Remote ID (LATAM)</h2>

      <div class="control">
        <label for="countrySelect">RECUERDA QUE PARA FUDO Y MAXIREST</label>
        <label for="countrySelect">FUDO-"ID LOCAL"</label>
        <label for="countrySelect">MXT-"ID LOCAL"</label>
        <label for="countrySelect">Pais</label>
        <select id="countrySelect"></select>
      </div>

      <div class="control">
        <label for="storeName">Nombre del local</label>
        <input id="storeName" type="text" placeholder="Ej: Los Locos del Sabor" autocomplete="off">
      </div>

      <div class="preview-container remote-big" id="remoteResult">-</div>
      <button class="csv" id="copyRemote">Copiar Remote ID</button>
    </div>

    <!-- (4) Correos -->
    <div class="panel">
      <h2>Separador de correos</h2>

      <div class="control">
        <label for="emailsInput">Pega correos (desde Excel, con comas)</label>
        <textarea id="emailsInput" rows="5" placeholder="a@a.com, b@b.com, c@c.com"></textarea>
      </div>

      <div class="control">
        <label for="emailsOutput">Resultado (para pegar en destinatarios)</label>
        <textarea id="emailsOutput" rows="5" readonly></textarea>
      </div>

      <button class="csv" id="copyEmails">Copiar correos</button>
    </div>
  </div>

  <script>
    /* =====================
       Dark toggle (igual)
       ===================== */
    const toggle = document.getElementById("darkToggle");
    let isDark = false;

    toggle.addEventListener("click", () => {
      isDark = !isDark;
      document.body.classList.toggle("dark", isDark);
      toggle.innerHTML = isDark ? '<div class="moon"></div>' : '<div class="sun"></div>';
    });

    /* =====================
       Excel → CSV (con spinner/check + duplicados + BOM + nombre original)
       ===================== */
    const fileInputXLSX = document.getElementById('fileInputXLSX');
    const fileLabelXLSX = document.getElementById('fileLabelXLSX');
    const previewContainer = document.getElementById('previewContainer');
    const warning = document.getElementById('warning');
    const duplicatesDiv = document.getElementById('duplicates');
    const dropArea = document.getElementById('dropXLSX');
    const spinner = document.getElementById('spinner');
    const checkmark = document.getElementById('checkmark');

    let currentWorksheet = null;
    let originalBaseName = "archivo";

    fileInputXLSX.addEventListener('change', () => {
      const file = fileInputXLSX.files[0];
      if (!file) return;

      originalBaseName = file.name.replace(/\.[^/.]+$/, "");
      dropArea.classList.add("loaded");

      // reset UI
      spinner.style.display = "block";
      checkmark.classList.remove("show-check");

      const reader = new FileReader();
      reader.onload = e => {
        // mismo efecto de carga: pequeño delay para que se vea spinner
        setTimeout(() => {
          const workbook = XLSX.read(new Uint8Array(e.target.result), { type: "array" });
          const sheet = workbook.Sheets[workbook.SheetNames[0]];
          currentWorksheet = sheet;

          const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
          showPreview(jsonData);

          spinner.style.display = "none";
          checkmark.classList.add("show-check");
          fileLabelXLSX.textContent = "Archivo cargado: " + file.name;
        }, 700);
      };
      reader.readAsArrayBuffer(file);
    });

    function showPreview(data) {
      if (!data.length) {
        previewContainer.innerHTML = "<em>No se detectaron datos.</em>";
        warning.textContent = "";
        warning.classList.remove("active");
        duplicatesDiv.innerHTML = "";
        return;
      }

      const seen = new Set(), dupes = new Set();

      // columna F = index 5
      for (let i = 1; i < data.length; i++) {
        const val = data[i][5];
        if (val !== undefined && val !== null && String(val).trim() !== "") {
          const key = String(val);
          if (seen.has(key)) dupes.add(key);
          else seen.add(key);
        }
      }

      if (dupes.size) {
        warning.textContent = "⚠️ Duplicados en columna F:";
        warning.classList.add("active");
      } else {
        warning.textContent = "";
        warning.classList.remove("active");
      }

      duplicatesDiv.innerHTML = Array.from(dupes).map(v => `<span>${escapeHtml(v)}</span>`).join("");

      const headers = data[0].map((_, i) => String.fromCharCode(65 + i));
      let html = "<table><thead><tr><th>#</th>";
      headers.forEach(h => html += `<th>${h}</th>`);
      html += "</tr></thead><tbody>";

      for (let i = 0; i < Math.min(data.length, 20); i++) {
        html += `<tr><td class='row-number'>${i + 1}</td>`;
        data[i].forEach((cell, j) => {
          const cellStr = (cell === undefined || cell === null) ? "" : String(cell);
          const isDup = j === 5 && dupes.has(cellStr);
          html += `<td class='${isDup ? "duplicate" : ""}'>${escapeHtml(cellStr)}</td>`;
        });
        html += "</tr>";
      }
      html += "</tbody></table>";
      previewContainer.innerHTML = html;
    }

    function convertToCSV() {
      if (!currentWorksheet) return alert("Selecciona primero un archivo Excel.");

      // CSV con ; (igual) y BOM UTF-8 (evita símbolos raros al abrir)
      const csv = XLSX.utils.sheet_to_csv(currentWorksheet, { FS: ";", RS: "\n" });
      const BOM = new Uint8Array([0xEF, 0xBB, 0xBF]);
      const blob = new Blob([BOM, csv], { type: "text/csv;charset=utf-8;" });

      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = originalBaseName + ".csv";
      link.click();
    }

    /* =====================
       CSV → Excel (TextDecoder fallback como el original)
       ===================== */
    const fileInputCSV = document.getElementById('fileInputCSV');
    const fileLabelCSV = document.getElementById('fileLabelCSV');

    fileInputCSV.addEventListener('change', () => {
      const files = fileInputCSV.files;
      if (files.length === 0) return;
      const names = Array.from(files).map(f => f.name).join(", ");
      fileLabelCSV.textContent = "Archivos: " + names;
    });

    function convertMultipleCSVs() {
      const files = fileInputCSV.files;
      if (!files.length) return alert("Selecciona al menos un archivo CSV (máximo 2).");
      if (files.length > 2) return alert("Solo se permiten 2 archivos CSV a la vez.");

      Array.from(files).forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          let text = "";

          try {
            text = new TextDecoder("utf-8").decode(e.target.result);
          } catch {
            // fallback simple (por si el navegador no soporta TextDecoder)
            text = String(e.target.result);
          }

          // si hay caracteres raros, intenta iso-8859-1
          if (/[\uFFFD]/.test(text)) {
            text = new TextDecoder("iso-8859-1").decode(new Uint8Array(e.target.result));
          }

          // elimina BOM si existe
          text = text.replace(/^\uFEFF/, "");

          const rows = text
            .split(/\r?\n/)
            .filter(l => l.trim() !== "")
            .map(l => l.split(";"));

          const wb = XLSX.utils.book_new();
          const ws = XLSX.utils.aoa_to_sheet(rows);
          XLSX.utils.book_append_sheet(wb, ws, "Hoja1");

          const outName = file.name.replace(/\.[^/.]+$/, "") + ".xlsx";
          XLSX.writeFile(wb, outName, { compression: true });
        };
        reader.readAsArrayBuffer(file);
      });
    }

    /* =====================
       Remote ID (más contenido + caja grande + país completo)
       ===================== */
    const LATAM = [
      { name: "Argentina", code: "AR" },
      { name: "Chile", code: "CL" },
      { name: "Peru", code: "PE" },
      { name: "Uruguay", code: "UY" },
      { name: "Paraguay", code: "PY" },
      { name: "Colombia", code: "CO" },
      { name: "Costa Rica", code: "CR" },
      { name: "Republica Dominicana", code: "DO" },
      { name: "Mexico", code: "MX" },
      { name: "Ecuador", code: "EC" },
      { name: "Panama", code: "PA" },
      { name: "Paraguay", code: "PY" }
    ];

    const countrySelect = document.getElementById("countrySelect");
    const storeName = document.getElementById("storeName");
    const remoteResult = document.getElementById("remoteResult");
    const copyRemote = document.getElementById("copyRemote");

    function initCountries() {
      LATAM.forEach(({name, code}) => {
        const opt = document.createElement("option");
        opt.value = code;
        opt.textContent = `${name} (${code})`;
        countrySelect.appendChild(opt);
      });
      countrySelect.value = "AR";
      updateRemote();
    }

    function normalizeStore(str) {
      if (!str) return "";
      let s = str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
      s = s.replace(/ñ/g, "n").replace(/Ñ/g, "N");
      s = s.replace(/[^a-zA-Z0-9 ]/g, "");
      s = s.trim().replace(/\s+/g, " ");
      s = s.length ? s.split(" ").join("-") : "";
      return s.toUpperCase();
    }

    function updateRemote() {
      const code = countrySelect.value || "AR";
      const countryName = (countrySelect.options[countrySelect.selectedIndex]?.textContent || "Argentina (AR)")
        .split(" (")[0]
        .toUpperCase();

      const local = (storeName.value || "").trim();

      if (!local) {
        remoteResult.textContent = "-";
        return;
      }

      const norm = normalizeStore(local);
      const remoteId = `${code}-${norm}-0001`;

      remoteResult.textContent =
        `PAIS: ${countryName}\n` +
        `NOMBRE: ${local.toUpperCase()}\n` +
        `REMOTE ID: ${remoteId}`;
    }

    countrySelect.addEventListener("change", updateRemote);
    storeName.addEventListener("input", updateRemote);

    copyRemote.addEventListener("click", async () => {
      const local = (storeName.value || "").trim();
      if (!local) return alert("Escribe el nombre del local primero.");
      const code = countrySelect.value || "AR";
      const remoteId = `${code}-${normalizeStore(local)}-0001`;
      await copyText(remoteId);
    });

    /* =====================
       Correos
       ===================== */
    const emailsInput = document.getElementById("emailsInput");
    const emailsOutput = document.getElementById("emailsOutput");
    const copyEmails = document.getElementById("copyEmails");

    function splitEmails(text) {
      if (!text) return [];
      const parts = text
        .replace(/\r/g, "\n")
        .split(/[,;\n]+/g)
        .map(x => x.trim())
        .filter(Boolean);

      const seen = new Set();
      const out = [];
      for (const p of parts) {
        const k = p.toLowerCase();
        if (!seen.has(k)) {
          seen.add(k);
          out.push(p);
        }
      }
      return out;
    }

    function updateEmails() {
      const list = splitEmails(emailsInput.value);
      emailsOutput.value = list.join("\n");
    }

    emailsInput.addEventListener("input", updateEmails);

    copyEmails.addEventListener("click", async () => {
      const value = (emailsOutput.value || "").trim();
      if (!value) return alert("No hay correos para copiar.");
      await copyText(value);
    });

    /* =====================
       Utils: copy + escapeHtml
       ===================== */
    async function copyText(text) {
      try {
        await navigator.clipboard.writeText(text);
      } catch {
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
      }
    }

    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // init
    initCountries();
    updateEmails();
  </script>
</body>
</html>




